{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/errors.ts","webpack:///./node_modules/node-libs-browser/node_modules/events/events.js","webpack:///./src/message.ts","webpack:///./src/subscriptions/subscription.ts","webpack:///./src/socket.ts","webpack:///./node_modules/isomorphic-ws/browser.js","webpack:///./node_modules/uuid/index.js","webpack:///./node_modules/uuid/lib/rng-browser.js","webpack:///./node_modules/uuid/lib/bytesToUuid.js","webpack:///./src/channels/channel.ts","webpack:///./src/index.ts","webpack:///(webpack)/buildin/global.js","webpack:///./node_modules/uuid/v1.js","webpack:///./node_modules/uuid/v4.js","webpack:///./src/socket/pingpong.ts","webpack:///./src/socket/heartbeat.ts","webpack:///./src/server.ts","webpack:///./src/channels/manager.ts","webpack:///./src/subscriptions/manager.ts"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","SocketIsDead","Error","[object Object]","msg","super","setPrototypeOf","this","SocketNotOpened","ResponseTimeout","BizarreMessage","SocketNoPong","EventEmitter","_events","_maxListeners","undefined","isFunction","arg","isObject","isUndefined","defaultMaxListeners","setMaxListeners","isNumber","isNaN","TypeError","emit","type","er","handler","len","args","listeners","error","length","arguments","err","context","Array","slice","apply","addListener","listener","newListener","push","warned","console","trace","on","once","fired","g","removeListener","list","position","splice","removeAllListeners","listenerCount","evlistener","emitter","Message","payload","id","subscriptionId","props","newId","newSubscriptionId","json","data","JSON","parse","default","events","Subscription","channel","socket","bindSocketEventHandlers","WS","uuid","message_1","pingpong_1","heartbeat_1","Errors","Socket","ws","options","responseTimeoutMs","pingpong","heartbeat","heartbeatIntervalMs","bindHeartbeatEventHandlers","isAlive","readyState","OPEN","address","close","message","protocol","isOpen","with","v4","Promise","resolve","reject","sendRaw","timeout","setTimeout","self","callback","response","clearTimeout","onopen","event","onerror","onclose","code","reason","kill","onmessage","receiveRaw","fromJSON","onError","stringify","send","global","WebSocket","MozWebSocket","window","v1","getRandomValues","crypto","msCrypto","rnds8","Uint8Array","rnds","Math","random","byteToHex","toString","substr","buf","offset","bth","join","subscriptions","subscription","indexOf","remove","log","filter","socketMessage","socket_1","server_1","Server","channel_1","Channel","manager_1","ChannelManager","subscription_1","manager_2","SubscriptionManager","Function","eval","e","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","b","node","clockseq","seedBytes","msecs","Date","getTime","nsecs","dt","tl","tmh","ii","onPing","catch","pongMessage","intervalMs","alive","lastActivityAt","interval","setInterval","checkIsAlive","trackLastActivity","lastActivityAtMsAgo","ping","clearInterval","sockets","wss","host","port","onConnection","channels","onMessage","channelName","reducer","onUnsubscribe","onSubscribe","getSubscriptions","find","add","ackMessage","toJSON","clientSubscription","existingSubscription","then","serverSubscription"],"mappings":"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","file":"socket.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 10);\n","// NOTE: https://github.com/Microsoft/TypeScript-wiki/blob/master/Breaking-Changes.md#extending-built-ins-like-error-array-and-map-may-no-longer-work\n\nexport class SocketIsDead extends Error { constructor(msg: any = null) { super(msg); Object.setPrototypeOf(this, SocketIsDead.prototype) } }\nexport class SocketNotOpened extends Error { constructor(msg: any = null) { super(msg); Object.setPrototypeOf(this, SocketNotOpened.prototype) } }\nexport class ResponseTimeout extends Error { constructor(msg: any = null) { super(msg); Object.setPrototypeOf(this, ResponseTimeout.prototype) } }\nexport class BizarreMessage extends Error { constructor(msg: any = null) { super(msg); Object.setPrototypeOf(this, BizarreMessage.prototype) } }\nexport class SocketNoPong extends Error { constructor(msg: any = null) { super(msg); Object.setPrototypeOf(this, SocketNoPong.prototype) } }","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\nfunction EventEmitter() {\n  this._events = this._events || {};\n  this._maxListeners = this._maxListeners || undefined;\n}\nmodule.exports = EventEmitter;\n\n// Backwards-compat with node 0.10.x\nEventEmitter.EventEmitter = EventEmitter;\n\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function(n) {\n  if (!isNumber(n) || n < 0 || isNaN(n))\n    throw TypeError('n must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nEventEmitter.prototype.emit = function(type) {\n  var er, handler, len, args, i, listeners;\n\n  if (!this._events)\n    this._events = {};\n\n  // If there is no 'error' event listener then throw.\n  if (type === 'error') {\n    if (!this._events.error ||\n        (isObject(this._events.error) && !this._events.error.length)) {\n      er = arguments[1];\n      if (er instanceof Error) {\n        throw er; // Unhandled 'error' event\n      } else {\n        // At least give some kind of context to the user\n        var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n        err.context = er;\n        throw err;\n      }\n    }\n  }\n\n  handler = this._events[type];\n\n  if (isUndefined(handler))\n    return false;\n\n  if (isFunction(handler)) {\n    switch (arguments.length) {\n      // fast cases\n      case 1:\n        handler.call(this);\n        break;\n      case 2:\n        handler.call(this, arguments[1]);\n        break;\n      case 3:\n        handler.call(this, arguments[1], arguments[2]);\n        break;\n      // slower\n      default:\n        args = Array.prototype.slice.call(arguments, 1);\n        handler.apply(this, args);\n    }\n  } else if (isObject(handler)) {\n    args = Array.prototype.slice.call(arguments, 1);\n    listeners = handler.slice();\n    len = listeners.length;\n    for (i = 0; i < len; i++)\n      listeners[i].apply(this, args);\n  }\n\n  return true;\n};\n\nEventEmitter.prototype.addListener = function(type, listener) {\n  var m;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events)\n    this._events = {};\n\n  // To avoid recursion in the case that type === \"newListener\"! Before\n  // adding it to the listeners, first emit \"newListener\".\n  if (this._events.newListener)\n    this.emit('newListener', type,\n              isFunction(listener.listener) ?\n              listener.listener : listener);\n\n  if (!this._events[type])\n    // Optimize the case of one listener. Don't need the extra array object.\n    this._events[type] = listener;\n  else if (isObject(this._events[type]))\n    // If we've already got an array, just append.\n    this._events[type].push(listener);\n  else\n    // Adding the second element, need to change to array.\n    this._events[type] = [this._events[type], listener];\n\n  // Check for listener leak\n  if (isObject(this._events[type]) && !this._events[type].warned) {\n    if (!isUndefined(this._maxListeners)) {\n      m = this._maxListeners;\n    } else {\n      m = EventEmitter.defaultMaxListeners;\n    }\n\n    if (m && m > 0 && this._events[type].length > m) {\n      this._events[type].warned = true;\n      console.error('(node) warning: possible EventEmitter memory ' +\n                    'leak detected. %d listeners added. ' +\n                    'Use emitter.setMaxListeners() to increase limit.',\n                    this._events[type].length);\n      if (typeof console.trace === 'function') {\n        // not supported in IE 10\n        console.trace();\n      }\n    }\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.once = function(type, listener) {\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  var fired = false;\n\n  function g() {\n    this.removeListener(type, g);\n\n    if (!fired) {\n      fired = true;\n      listener.apply(this, arguments);\n    }\n  }\n\n  g.listener = listener;\n  this.on(type, g);\n\n  return this;\n};\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener = function(type, listener) {\n  var list, position, length, i;\n\n  if (!isFunction(listener))\n    throw TypeError('listener must be a function');\n\n  if (!this._events || !this._events[type])\n    return this;\n\n  list = this._events[type];\n  length = list.length;\n  position = -1;\n\n  if (list === listener ||\n      (isFunction(list.listener) && list.listener === listener)) {\n    delete this._events[type];\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n\n  } else if (isObject(list)) {\n    for (i = length; i-- > 0;) {\n      if (list[i] === listener ||\n          (list[i].listener && list[i].listener === listener)) {\n        position = i;\n        break;\n      }\n    }\n\n    if (position < 0)\n      return this;\n\n    if (list.length === 1) {\n      list.length = 0;\n      delete this._events[type];\n    } else {\n      list.splice(position, 1);\n    }\n\n    if (this._events.removeListener)\n      this.emit('removeListener', type, listener);\n  }\n\n  return this;\n};\n\nEventEmitter.prototype.removeAllListeners = function(type) {\n  var key, listeners;\n\n  if (!this._events)\n    return this;\n\n  // not listening for removeListener, no need to emit\n  if (!this._events.removeListener) {\n    if (arguments.length === 0)\n      this._events = {};\n    else if (this._events[type])\n      delete this._events[type];\n    return this;\n  }\n\n  // emit removeListener for all listeners on all events\n  if (arguments.length === 0) {\n    for (key in this._events) {\n      if (key === 'removeListener') continue;\n      this.removeAllListeners(key);\n    }\n    this.removeAllListeners('removeListener');\n    this._events = {};\n    return this;\n  }\n\n  listeners = this._events[type];\n\n  if (isFunction(listeners)) {\n    this.removeListener(type, listeners);\n  } else if (listeners) {\n    // LIFO order\n    while (listeners.length)\n      this.removeListener(type, listeners[listeners.length - 1]);\n  }\n  delete this._events[type];\n\n  return this;\n};\n\nEventEmitter.prototype.listeners = function(type) {\n  var ret;\n  if (!this._events || !this._events[type])\n    ret = [];\n  else if (isFunction(this._events[type]))\n    ret = [this._events[type]];\n  else\n    ret = this._events[type].slice();\n  return ret;\n};\n\nEventEmitter.prototype.listenerCount = function(type) {\n  if (this._events) {\n    var evlistener = this._events[type];\n\n    if (isFunction(evlistener))\n      return 1;\n    else if (evlistener)\n      return evlistener.length;\n  }\n  return 0;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  return emitter.listenerCount(type);\n};\n\nfunction isFunction(arg) {\n  return typeof arg === 'function';\n}\n\nfunction isNumber(arg) {\n  return typeof arg === 'number';\n}\n\nfunction isObject(arg) {\n  return typeof arg === 'object' && arg !== null;\n}\n\nfunction isUndefined(arg) {\n  return arg === void 0;\n}\n","import { SubscriptionId } from './subscriptions/subscription'\n\ntype MessageId = string\nexport { MessageId }\n\nclass Message {\n  public readonly type: string\n  public readonly payload: any\n  public readonly id?: MessageId\n  public readonly subscriptionId?: SubscriptionId\n\n  constructor(type: string, payload?: any, id?: MessageId, subscriptionId?: SubscriptionId) {\n    this.type = type\n    this.payload = payload\n    this.id = id\n    this.subscriptionId = subscriptionId\n  }\n\n  public with(props: Partial<{id: MessageId, subscriptionId: SubscriptionId}>) {\n    const newId = props.id ? props.id : this.id\n    const newSubscriptionId = props.subscriptionId ? props.subscriptionId : this.subscriptionId\n\n    const message = new Message(this.type, this.payload, newId, newSubscriptionId)\n    return message\n  }\n\n  public static fromJSON(json: string) {\n    const data = JSON.parse(json) as any\n    const message = new Message(data.type, data.payload, data.id, data.subscriptionId)\n    return message\n  }\n}\n\nexport default Message","import * as events from 'events'\n\nimport Socket from './../socket'\n\ntype SubscriptionId = string\nexport { SubscriptionId }\n\nclass Subscription extends events.EventEmitter {\n  public readonly id: SubscriptionId\n  public readonly channel: string\n  public readonly socket: Socket\n\n  constructor(id: SubscriptionId, channel: string, socket: Socket) {\n    super()\n    \n    this.id = id\n    this.channel = channel\n    this.socket = socket\n\n    this.bindSocketEventHandlers()\n  }\n\n  public toJSON() {\n    return {\n      id: this.id,\n      channel: this.channel\n    }\n  }\n\n  public static fromJSON(data: any, socket: Socket) {\n    const subscription = new Subscription(data.id, data.channel, socket)\n    return subscription\n  }\n\n  private bindSocketEventHandlers() {\n    this.socket.on('dead', () => {\n      this.emit('dead')\n    })\n  }\n}\n\nexport default Subscription","import * as WS from 'isomorphic-ws'\nimport * as events from 'events'\nimport * as uuid from 'uuid'\n\nimport Message from './message'\nimport PingPong from './socket/pingpong'\nimport Heartbeat from './socket/heartbeat'\nimport * as Errors from './errors'\n\ntype Protocol = 'PUSH' | 'CLIENT_SERVER'\nexport { Protocol }\n\ntype SocketOptions = {\n  responseTimeoutMs: number\n  heartbeatIntervalMs: number\n}\n\nclass Socket extends events.EventEmitter {\n  private ws: WS\n  \n  public readonly pingpong: PingPong\n  public readonly heartbeat: Heartbeat\n\n  private responseTimeoutMs: number = 5000\n\n  constructor(ws: WS, options: Partial<SocketOptions> = {}) {\n    super()\n    \n    this.ws = ws\n    this.pingpong = new PingPong(this)\n    this.heartbeat = new Heartbeat(this, options.heartbeatIntervalMs)\n\n    if (options && options.responseTimeoutMs) {\n      this.responseTimeoutMs = options.responseTimeoutMs\n    }\n    \n    this.bindSocketEventHandlers()\n    this.bindHeartbeatEventHandlers()\n  }\n\n  public isAlive() {\n    return this.heartbeat.isAlive()\n  }\n\n  public isOpen() {\n    return this.ws.readyState === WS.OPEN\n  }\n\n  public static connect(address: string, options?: WS.ClientOptions) {\n    const ws = new WS(address, options)\n    const socket = new Socket(ws)\n    return socket\n  }\n\n  public kill() {\n    this.ws.close()\n    this.emit('dead')\n  }\n\n  public send(message: Message, protocol: Protocol = 'PUSH'): Promise<Message | undefined> {\n    if (!this.isAlive()) {\n      throw new Errors.SocketIsDead()\n    }\n    if (!this.isOpen()) {\n      throw new Errors.SocketNotOpened()\n    }\n\n    switch(protocol) {\n      case 'CLIENT_SERVER': {\n        message = message.with({\n          id: uuid.v4()\n        })\n      }\n    }\n\n    return new Promise((resolve, reject) => {\n      this.sendRaw(message, reject)\n\n      switch(protocol) {\n        case 'PUSH': {\n          return resolve(undefined)\n        }\n        case 'CLIENT_SERVER': {\n          const timeout = setTimeout(() => {\n            const error = new Errors.ResponseTimeout(`Response timeout (${this.responseTimeoutMs}ms)`)\n            reject(error)\n          }, this.responseTimeoutMs)\n\n          const self = this\n          const callback = (response: Message) => {\n            if (message.id !== response.id) {\n              return\n            }\n\n            clearTimeout(timeout)\n            self.removeListener('message', callback)\n\n            resolve(response)\n          }\n\n          this.on('message', callback)\n        }\n      }\n    })\n  }\n\n  private bindSocketEventHandlers() {\n    this.ws.onopen = (event: any) => {\n      this.emit('open')\n    }\n\n    this.ws.onerror = (event: {error: any, message: string, type: string}) => {\n      this.emit('error', event.error)\n    }\n\n    this.ws.onclose = (event: { wasClean: boolean; code: number; reason: string }) => {\n      this.emit('close', event.code, event.reason)\n      this.kill()\n    }\n\n    this.ws.onmessage = (event: { data: any; type: string }) => {\n      try {\n        const message = this.receiveRaw(event.data)\n        this.emit('message', message)\n      } catch (error) {\n        this.emit('error', error)\n      }\n    }\n  }\n\n  private bindHeartbeatEventHandlers() {\n    this.heartbeat.on('dead', () => {\n      this.kill()\n    })\n  }\n\n  private receiveRaw(data: WS.Data) {\n    const message = Message.fromJSON(data as string)\n    return message\n  }\n\n  private sendRaw(message: Message, onError: (error: Error) => void) {\n    const data = JSON.stringify(message)\n    this.ws.send(data, {}, (err?: Error) => {\n      if (err) {\n        onError(err)\n      }\n    })\n  }\n}\n\nexport default Socket\n","// https://github.com/maxogden/websocket-stream/blob/48dc3ddf943e5ada668c31ccd94e9186f02fafbd/ws-fallback.js\n\nvar ws = null\n\nif (typeof WebSocket !== 'undefined') {\n  ws = WebSocket\n} else if (typeof MozWebSocket !== 'undefined') {\n  ws = MozWebSocket\n} else if (typeof global !== 'undefined') {\n  ws = global.WebSocket || global.MozWebSocket\n} else if (typeof window !== 'undefined') {\n  ws = window.WebSocket || window.MozWebSocket\n} else if (typeof self !== 'undefined') {\n  ws = self.WebSocket || self.MozWebSocket\n}\n\nmodule.exports = ws\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","import Subscription from './../subscriptions/subscription'\nimport Message from './../message'\n\nclass Channel {\n  public readonly name: string\n  private subscriptions: Subscription[] = []\n\n  constructor(name: string) {\n    this.name = name\n  }\n\n  public getSubscriptions() {\n    return this.subscriptions\n  }\n\n  public add(subscription: Subscription) {\n    if (this.subscriptions.indexOf(subscription) > -1) {\n      return\n    }\n\n    subscription.on('dead', () => {\n      this.remove(subscription)\n    })\n\n    console.log(`Subscription ${subscription.id} was added to channel ${this.name}`)\n    this.subscriptions.push(subscription)\n  }\n\n  public remove(subscription: Subscription) {\n    console.log(`Subscription ${subscription.id} was removed from channel ${this.name}`)\n    this.subscriptions = this.subscriptions.filter(s => s !== subscription)\n  }\n\n  public async broadcast(message: Message) {\n    for (let subscription of this.subscriptions) {\n      if (!subscription.socket.isAlive()) {\n        continue\n      }\n      if (!subscription.socket.isOpen()) {\n        continue\n      }\n\n      const socketMessage = message.with({\n        subscriptionId: subscription.id\n      })\n\n      await subscription.socket.send(socketMessage, 'PUSH')\n    }\n  }\n\n  private bindSocketEventsHandlers() {\n    \n  }\n}\n\nexport default Channel","import Socket from './socket'\nimport Message from './message'\nimport Server from './server'\nimport Channel from './channels/channel'\nimport ChannelManager from './channels/manager'\nimport Subscription from './subscriptions/subscription'\nimport SubscriptionManager from './subscriptions/manager'\nimport * as Errors from './errors'\n\nif (typeof window !== 'undefined') {\n    (window as any).Socket = Socket;\n    (window as any).Message = Message;\n    (window as any).Server = Server;\n    (window as any).Channel = Channel;\n    (window as any).ChannelManager = ChannelManager;\n    (window as any).Subscription = Subscription;\n    (window as any).SubscriptionManager = SubscriptionManager;\n}\n\nexport {\n    Socket, Server, Channel, ChannelManager,\n    Subscription, SubscriptionManager,\n    Errors\n}","var g;\r\n\r\n// This works in non-strict mode\r\ng = (function() {\r\n\treturn this;\r\n})();\r\n\r\ntry {\r\n\t// This works if eval is allowed (see CSP)\r\n\tg = g || Function(\"return this\")() || (1, eval)(\"this\");\r\n} catch (e) {\r\n\t// This works if the window reference is available\r\n\tif (typeof window === \"object\") g = window;\r\n}\r\n\r\n// g can still be undefined, but nothing to do about it...\r\n// We return undefined, instead of nothing here, so it's\r\n// easier to handle this case. if(!global) { ...}\r\n\r\nmodule.exports = g;\r\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","// https://stackoverflow.com/questions/45928105/can-a-javascript-client-using-websockets-programatically-detect-ping-pong-activi\n// https://github.com/websockets/ws/issues/675#issuecomment-195120612\n\nimport * as events from 'events'\n\nimport Socket from '../socket'\nimport Message from '../message'\nimport * as Errors from './../errors'\n\n/**\n * Plugin for echoing `ping` messages with `pong` responses\n */\nclass PingPong extends events.EventEmitter {\n  private socket: Socket\n\n  constructor(socket: Socket) {\n    super()\n    this.socket = socket\n\n    this.socket.on('message', (message: Message) => {\n      if (message.type === 'ping') {\n        return this.onPing(message).catch(this.onError.bind(this))\n      }\n    })\n  }\n\n  public async ping() {\n    const message = new Message('ping')\n\n    try {\n      await this.socket.send(message, 'CLIENT_SERVER')\n    } catch(error) {\n      if (error instanceof Errors.ResponseTimeout) {\n        const err = new Errors.SocketNoPong()\n        throw err\n        return\n      }\n      throw error\n    }\n    \n    this.emit('pong')\n  }\n\n  private async onPing(message: Message) {\n    this.emit('ping')\n    const pongMessage = new Message('pong', undefined, message.id)\n    await this.socket.send(pongMessage, 'PUSH')\n  }\n\n  private async onError(error: Error) {\n    console.error(`PingPong error: ${error.message}`)\n    this.emit('error', error)\n  }\n}\n\nexport default PingPong","// https://stackoverflow.com/questions/45928105/can-a-javascript-client-using-websockets-programatically-detect-ping-pong-activi\n// https://github.com/websockets/ws/issues/675#issuecomment-195120612\n\nimport * as events from 'events'\n\nimport Socket from './../socket'\nimport * as Errors from './../errors'\n\n/**\n * Plugin for checking if socket aliveness\n * Sends `ping` if there no messages were received during `intervalMs` period\n * Terminates the socket if there no any messages were received in 2 * `intervalMs` ms\n */\nclass Alive extends events.EventEmitter {\n  private socket: Socket\n  private alive: boolean = true\n\n  private intervalMs: number = 10000\n  private interval: any // NodeJS.Timer\n\n  private lastActivityAt: Date = new Date()\n\n  constructor(socket: Socket, intervalMs?: number) {\n    super()\n    this.socket = socket\n\n    if (intervalMs) { this.intervalMs = intervalMs }\n    this.interval = setInterval(() => {\n      this.checkIsAlive().catch(this.onError.bind(this))\n    }, this.intervalMs)\n\n    this.socket.on('message', this.trackLastActivity.bind(this))\n    this.socket.pingpong.on('ping', this.trackLastActivity.bind(this))\n    this.socket.pingpong.on('pong', this.trackLastActivity.bind(this))\n  }\n\n  public isAlive() {\n    return this.alive\n  }\n\n  private trackLastActivity() {\n    this.lastActivityAt = new Date()\n  }\n\n  private async checkIsAlive() {\n    const now = (new Date).getTime()\n    const lastActivityAtMsAgo = now - this.lastActivityAt.getTime()\n    \n    if (lastActivityAtMsAgo > 3 * this.intervalMs) {\n      console.log(`HEARTBEAT: lastActivityAtMsAgo = ${lastActivityAtMsAgo}`)\n      this.kill()\n      return\n    }\n\n    if (lastActivityAtMsAgo > this.intervalMs) {\n      try {\n        await this.socket.pingpong.ping()\n      } catch(error) {\n        if (error instanceof Errors.SocketIsDead) {\n          console.log('Heartbeat: SocketIsDead')\n          return\n        }\n        if (error instanceof Errors.SocketNoPong) {\n          console.log('Heartbeat: SocketNoPong')\n          this.kill()\n          return\n        }\n        if (error instanceof Errors.SocketNotOpened) {\n          console.log('Heartbeat: SocketNotOpened')\n          this.kill()\n          return\n        }\n\n        throw error\n      }\n      \n      return\n    }\n  }\n\n  private kill() {\n    this.alive = false\n    clearInterval(this.interval)\n    this.emit('dead')\n  }\n\n  private async onError(error: Error) {\n    console.error(`Heartbeat error: ${error.message}`)\n    this.emit('error', error)\n  }\n}\n\nexport default Alive","import * as WS from 'isomorphic-ws'\nimport * as events from 'events'\n\nimport Socket from './socket'\n\nclass Server extends events.EventEmitter {\n\n    private wss: WS.Server\n    private sockets: Socket[] = []\n\n    public listen(options: Partial<{host: string, port: number}>) {\n        this.wss = new WS.Server({\n            host: options.host || '0.0.0.0',\n            port: options.port || 8000\n        })\n\n        this.wss.on('connection', this.onConnection.bind(this))\n        this.wss.on('error', this.onError.bind(this))\n    }\n\n    private onConnection(ws: WS) {\n        const socket = new Socket(ws)\n        this.bindSocketEventHandlers(socket)\n        \n        this.sockets.push(socket)\n        this.emit('connection', socket)\n    }\n\n    private onError(ws: WS, error: Error) {\n        console.error(`Socket ${ws} error: ${JSON.stringify(error)}`)\n        this.emit('error', error)\n    }\n\n    private bindSocketEventHandlers(socket: Socket) {\n        socket.on('dead', () => {\n            this.sockets = this.sockets.filter(s => s !== socket)\n        })\n    }\n}\n\nexport default Server\n","import * as uuid from 'uuid'\n\nimport Channel from './channel'\nimport Subscription from './../subscriptions/subscription'\nimport Socket from '../socket'\nimport Message from '../message'\nimport * as Errors from '../errors'\n\nclass Manager {\n  public readonly channels: {[key: string]: Channel} = {}\n\n  public listen(socket: Socket) {\n    socket.on('message', this.onMessage.bind(this, socket))\n  }\n\n  public getOrCreateChannel(channelName: string) {\n    let channel = this.channels[channelName]\n    if (!channel) {\n      channel = new Channel(channelName)\n      this.channels[channelName] = channel\n    }\n    return channel\n  }\n\n  private onMessage(socket: Socket, message: Message) {\n    this.reducer(socket, message)\n      .catch((error: Error) => {\n        console.error(`Reducer: error ${error} handling ${message}`)\n      })\n  }\n\n  private async reducer(socket: Socket, message: Message) {\n    if (message.type === 'subscribe') {\n      await this.onSubscribe(socket, message)\n      return\n    }\n\n    if (message.type === 'unsubscribe') {\n      await this.onUnsubscribe(socket, message)\n      return\n    }\n  }\n\n  private async onSubscribe(socket: Socket, message: Message) {\n    let invalid = !message.payload || !message.payload.channel\n    if (invalid) {\n      const error = new Errors.BizarreMessage(JSON.stringify(message))\n      throw error\n    }\n\n    const channelName = message.payload.channel\n    let channel = this.channels[channelName]\n    if (!channel) {\n      channel = new Channel(channelName)\n      this.channels[channelName] = channel\n    }\n\n    const subscriptions = channel.getSubscriptions()\n    let subscription = subscriptions.find(s => s.socket === socket)\n    if (!subscription) {\n      const newId = uuid.v4()\n      subscription = new Subscription(newId, channelName, socket)\n    }\n\n    channel.add(subscription)\n\n    // Send ack\n    const ackMessage = new Message('subscribed', {\n      subscription: subscription.toJSON()\n    }, message.id)\n    await socket.send(ackMessage, 'PUSH')\n  }\n\n  private async onUnsubscribe(socket: Socket, message: Message) {\n    let invalid = !message.payload || !message.payload.subscription\n    if (invalid) {\n      const error = new Errors.BizarreMessage(JSON.stringify(message))\n      throw error\n    }\n\n    const clientSubscription = Subscription.fromJSON(message.payload.subscription, socket)\n\n    let channel = this.channels[clientSubscription.channel]\n    if (!channel) {\n      return\n    }\n\n    const subscriptions = channel.getSubscriptions()\n    let subscription = subscriptions.find(s => s.id === clientSubscription.id)\n    if (!subscription) {\n      return\n    }\n\n    channel.remove(subscription)\n\n    // Send ack\n    const ackMessage = new Message('unsubscribed', {\n      subscription: subscription.toJSON()\n    }, message.id)\n    await socket.send(ackMessage, 'PUSH')\n  }\n}\n\nexport default Manager","import Socket from '../socket'\nimport Subscription from './subscription'\nimport Message from '../message'\nimport * as Errors from '../errors'\n\nclass Manager {\n  private socket: Socket\n  private subscriptions: Subscription[] = []\n\n  constructor(socket: Socket) {\n    this.socket = socket\n    socket.on('message', this.onMessage.bind(this))\n  }\n\n  public getSubscriptions() {\n    return this.subscriptions\n  }\n\n  private onMessage(message: Message) {\n    const subscriptionId = message.subscriptionId\n    if (!subscriptionId) {\n      return\n    }\n\n    const subscription = this.subscriptions.find(s => s.id === subscriptionId)\n    if (!subscription) {\n      return\n    }\n\n    subscription.emit('message', message)\n  }\n\n  subscribe(channel: string): Promise<Subscription> {\n    const message = new Message('subscribe', { channel })\n\n    const existingSubscription = this.subscriptions.find(s => s.channel === channel)\n    if (existingSubscription) {\n      return Promise.resolve(existingSubscription)\n    }\n\n    return this.socket.send(message, 'CLIENT_SERVER').then((response: Message) => {\n      let invalid = response.type !== 'subscribed' || !response.payload || !response.payload.subscription\n\n      if (invalid) {\n        const error = new Errors.BizarreMessage(JSON.stringify(response))\n        throw error\n      }\n\n      const subscription = Subscription.fromJSON(response.payload.subscription, this.socket)\n      this.subscriptions.push(subscription)\n\n      return subscription\n    })\n  }\n\n  unsubscribe(subscription: Subscription): Promise<boolean> {\n    const message = new Message('unsubscribe', {\n      subscription: subscription.toJSON()\n    })\n\n    return this.socket.send(message, 'CLIENT_SERVER').then((response: Message) => {\n      let invalid = response.type !== 'unsubscribed' || !response.payload || !response.payload.subscription\n\n      if (invalid) {\n        const error = new Errors.BizarreMessage(JSON.stringify(response))\n        throw error\n      }\n\n      const serverSubscription = Subscription.fromJSON(response.payload.subscription, this.socket)\n      if (serverSubscription.id !== subscription.id) {\n        const error = new Errors.BizarreMessage(`Desync: ${JSON.stringify(serverSubscription)} on server, ${JSON.stringify(subscription)} on client`)\n        throw error\n      }\n\n      this.subscriptions = this.subscriptions.filter(s => s.id !== subscription.id)\n      \n      return true\n    })\n  }\n}\n\nexport default Manager"],"sourceRoot":""}